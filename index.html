<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GROTECH — SRI NEELKANTH IMPEX PVT. LTD.</title>

  <!-- Icons & Libraries -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    /* ====== Base & Variables ====== */
    :root{
      --brand-700:#004080;
      --brand-500:#0066cc;
      --muted:#f1f6fb;
      --text:#222;
      --glass: rgba(255,255,255,0.6);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:var(--text);
      background:linear-gradient(180deg,#f6fbff 0%, #ffffff 60%);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    a{color:inherit}
    img{max-width:100%;display:block}

    /* ====== NAVBAR ====== */
    .navbar{
      position:sticky;top:0;z-index:1200;
      backdrop-filter: blur(6px);
      background: linear-gradient(90deg, rgba(6,40,85,0.85), rgba(0,64,128,0.85));
      color:#fff;
      box-shadow: 0 6px 18px rgba(3, 37, 87, 0.12);
    }
    .nav-inner{
      max-width:1200px;margin:0 auto;padding:12px 20px;display:flex;align-items:center;gap:20px;
      justify-content:space-between;
    }
    .brand {
      display:flex;flex-direction:column;line-height:1;
    }
    .brand .big{font-size:20px;font-weight:800;letter-spacing:0.4px}
    .brand .small{font-size:12px;opacity:0.9}
    .nav-links{display:flex;gap:12px;align-items:center}
    .nav-links a{
      color:#dff1ff;text-decoration:none;padding:8px 12px;border-radius:8px;font-weight:600;font-size:14px;
      transition:all .18s;
    }
    .nav-links a:hover{ background: rgba(255,255,255,0.06); color: #fff; transform:translateY(-1px) }
    .cart-toggle{
      background:transparent;border:2px solid rgba(255,255,255,0.12);color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer;
      display:flex;align-items:center;gap:8px;font-weight:700;
    }

    /* ====== PAGE LAYOUT ====== */
    main{max-width:1200px;margin:28px auto;padding:0 18px}
    section{margin-bottom:48px}

    /* ====== HERO ====== */
    .hero{
      background: linear-gradient(135deg,var(--brand-700) 0%, rgba(0,102,204,0.95) 60%);
      color:white;padding:48px;border-radius:12px;display:flex;gap:28px;align-items:center;overflow:hidden;
      box-shadow: 0 12px 40px rgba(0,64,128,0.12);
    }
    .hero-left{flex:1;min-width:260px}
    .hero h1{font-size:36px;margin:0 0 8px 0; font-weight:800}
    .hero h1 span{color: #cce6ff}
    .hero p.lead{margin:8px 0 18px 0;opacity:0.95;font-size:16px}
    .cta-group{display:flex;gap:12px;flex-wrap:wrap}
    .btn{
      display:inline-block;padding:12px 18px;border-radius:10px;text-decoration:none;font-weight:700;cursor:pointer;
      transition:all .16s;box-shadow:0 6px 18px rgba(2,48,103,0.12);
    }
    .btn-primary{background:#fff;color:var(--brand-700)}
    .btn-primary:hover{transform:translateY(-3px)}
    .btn-ghost{background:transparent;border:2px solid rgba(255,255,255,0.2);color:#fff}
    .hero-right{width:360px;min-width:240px}

    /* small cards row under hero */
    .hero-cards{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:14px}
    .mini-card{background:rgba(255,255,255,0.06);padding:12px;border-radius:10px;color:#fff;font-weight:600;text-align:center}

    /* ====== ABOUT (short) ====== */
    .about-snippet{background:#fff;border-radius:10px;padding:18px;box-shadow:0 8px 24px rgba(0,0,0,0.04)}
    .about-snippet p{color:#444}
    .know-more{margin-top:10px;display:inline-block;padding:8px 14px;border-radius:8px;background:var(--brand-500);color:white;text-decoration:none;font-weight:700}

    /* ====== PRODUCTS ====== */
    .products-head{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    .controls{display:flex;gap:10px;align-items:center}
    .controls input, .controls select{
      padding:10px 12px;border-radius:8px;border:1px solid #dfe8f4;background:white;min-width:180px;
    }
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px;margin-top:18px}
    .card{
      background:white;border-radius:12px;padding:14px;box-shadow:0 8px 20px rgba(12,30,60,0.06);display:flex;flex-direction:column;gap:10px;
    }
    .card-image{width:100%;height:150px;object-fit:cover;border-radius:8px;background:#f7f9fc}
    .card-title{font-weight:700;color:var(--brand-700);font-size:15px}
    .card-code{font-size:12px;color:#666}
    .card-footer{margin-top:auto;display:flex;gap:8px;align-items:center}
    .small-btn{padding:8px 10px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
    .add-btn{background:var(--brand-500);color:white}
    .chat-link{color:#25d366;text-decoration:none;font-weight:700}

    /* ====== Cart Panel (slide-in) ====== */
    .cart-panel{
      position:fixed;right:0;top:0;height:100vh;width:360px;background:white;box-shadow:-20px 0 60px rgba(3,37,87,0.12);
      transform:translateX(110%);transition:transform .32s ease-in-out;z-index:1400;display:flex;flex-direction:column;
    }
    .cart-panel.open{transform:translateX(0)}
    .cart-panel .panel-head{display:flex;align-items:center;justify-content:space-between;padding:18px;border-bottom:1px solid #f3f6fb}
    .cart-panel .panel-body{padding:18px;overflow:auto;flex:1}
    .cart-item{display:flex;gap:12px;align-items:center;padding:10px 0;border-bottom:1px solid #f5f7fb}
    .cart-item img{width:72px;height:56px;object-fit:cover;border-radius:6px}
    .cart-item .meta{flex:1}
    .cart-item .meta .name{font-weight:700;color:#0b3b6e}
    .cart-item .meta .variant{font-size:13px;color:#555}
    .qty-input{width:74px;padding:6px;border:1px solid #e6eefc;border-radius:6px}
    .panel-foot{padding:18px;border-top:1px solid #f3f6fb}
    .panel-foot .total{font-weight:800;color:#0a3a62;margin-bottom:10px}

    /* ====== ENQUIRY & CONTACT ====== */
    .form-card{background:white;padding:18px;border-radius:12px;box-shadow:0 10px 28px rgba(5,40,90,0.04);max-width:720px;margin:auto}
    .form-row{display:flex;gap:12px;flex-wrap:wrap}
    .form-row input, .form-row textarea{flex:1;padding:10px;border-radius:8px;border:1px solid #e6eefc}
    .form-row textarea{min-height:110px}
    .send-btn{background:var(--brand-700);color:white;padding:10px 14px;border-radius:8px;border:none;font-weight:800;cursor:pointer}

    /* ====== CONTACT CARDS ====== */
    .contact-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}
    .contact-card{background:white;padding:16px;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,0.04)}
    .muted{color:#64748b;font-size:14px}

    /* ====== FOOTER ====== */
    footer{background:linear-gradient(90deg,#003366,#004080);color:#fff;padding:30px 18px;border-radius:8px;margin:20px 0}
    .footer-inner{max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;gap:12px;align-items:center;flex-wrap:wrap}
    .quick-links a{display:inline-block;color:#dff1ff;margin-right:12px;text-decoration:none;font-weight:700}

    /* ====== Responsive ====== */
    @media(max-width:880px){
      .hero{flex-direction:column;gap:14px}
      .hero-right{width:100%}
      .nav-inner{padding:10px}
      .cart-panel{width:94vw}
    }
  </style>
</head>
<body>

  <!-- NAV -->
  <header class="navbar" role="banner">
    <div class="nav-inner">
      <div style="display:flex;gap:18px;align-items:center">
        <div class="brand">
          <div class="big">GROTECH</div>
          <div class="small">SRI NEELKANTH IMPEX PVT. LTD.</div>
        </div>
      </div>

      <nav class="nav-links" aria-label="Primary">
        <a href="#home">Home</a>
        <a href="#about">About</a>
        <a href="#products">Products</a>
        <a href="#enquiry">Enquiry</a>
        <a href="#contact">Contact</a>
        <button class="cart-toggle" id="open-cart-btn" title="Open cart">
          <i class="fa fa-shopping-cart"></i> Cart (<span id="cart-count">0</span>)
        </button>
      </nav>
    </div>
  </header>

  <!-- MAIN -->
  <main>

    <!-- HERO -->
    <section id="home" class="hero" aria-label="Hero">
      <div class="hero-left">
        <h1>Precision. Durability. <span>Performance.</span></h1>
        <p class="lead">Manufacturers & Exporters of premium hand tools, garden tools, automotive tools, and hardware since 2012.</p>

        <div class="cta-group">
          <a class="btn btn-primary" href="#products" onclick="document.getElementById('categoryFilter').focus();">Explore Products</a>
          <a class="btn btn-ghost" href="#contact">Contact Us</a>
        </div>

        <div style="margin-top:18px">
          <div class="about-snippet">
            <strong>About us</strong>
            <p style="margin:8px 0 0 0">SRI NEELKANTH IMPEX (GROTECH) — Headquartered in Ludhiana, manufacturing durable precision tools for professionals worldwide.</p>
            <a class="know-more" href="#about">Know more</a>
          </div>
        </div>
      </div>

      <div class="hero-right">
        <div style="color:#fff;font-weight:700;margin-bottom:12px">Quick categories</div>
        <div class="hero-cards">
          <div class="mini-card">Hand Tools</div>
          <div class="mini-card">Garden Tools</div>
          <div class="mini-card">Automotive</div>
          <div class="mini-card">Mason</div>
        </div>
      </div>
    </section>

    <!-- ABOUT (full) -->
    <section id="about" aria-labelledby="about-heading">
      <h2 id="about-heading" style="color:var(--brand-700)">About Us</h2>
      <div style="margin-top:14px" class="form-card">
        <h3>Our Story</h3>
        <p>Established in 2012 and headquartered in Ludhiana, Punjab, India, Sri Neelkanth Impex Private Limited has emerged as a distinguished manufacturer and exporter of premium-quality tools. Over the years, we've built a reputation for excellence in delivering Hand Tools, Garden Tools, Automotive Tools, Plumbing Tools, and Machine Tools.</p>
        <p>Our products are meticulously designed with accurate dimensions, exceptional strength, durable finishes, and corrosion resistance—making them ideal for diverse industrial applications. We pride ourselves on adhering to universally recognized quality standards.</p>
        <p>Under the leadership of Mr. Shiv Jindal and Mr. Keshav Jindal, we serve clients across the world with ethical business practices and transparent dealings.</p>
      </div>
    </section>

    <!-- PRODUCTS -->
    <section id="products" aria-labelledby="products-heading">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
        <div>
          <h2 id="products-heading" style="color:var(--brand-700)">Our Products</h2>
          <p class="muted">Browse by category or search by item code / name.</p>
        </div>

        <div class="controls" style="margin-left:auto">
          <input id="searchInput" placeholder="Search by Item Code, Name or Category..." onkeydown="if(event.key==='Enter'){performSearch()}"/>
          <select id="categoryFilter"><option value="">All Categories</option></select>
          <button class="small-btn" onclick="performSearch()">Search</button>
          <button class="small-btn" onclick="clearSearch()">Clear</button>
        </div>
      </div>

      <div id="breadcrumb" style="margin-top:12px"></div>
      <div id="catalogue" class="grid" style="margin-top:8px"></div>
    </section>

    <!-- ENQUIRY -->
    <section id="enquiry">
      <h2 style="color:var(--brand-700)">Send an Enquiry</h2>
      <div style="margin-top:18px" class="form-card">
        <div class="form-row">
          <input id="enq-name" placeholder="Name (required)" />
          <input id="enq-email" placeholder="Email (optional)" />
        </div>
        <div class="form-row" style="margin-top:10px">
          <input id="enq-mobile" placeholder="Mobile (required)" />
          <input id="enq-city" placeholder="City" />
        </div>
        <div style="margin-top:10px">
          <textarea id="enq-requirements" placeholder="Enter your requirement / list of items..."></textarea>
        </div>
        <div style="margin-top:12px;display:flex;gap:10px;align-items:center">
          <button class="send-btn" onclick="sendEnquiry()">Send via WhatsApp</button>
          <button class="send-btn" style="background:#0b3b6e" onclick="tryStoreEnquiry()">Save to Sheet (optional)</button>
          <div style="margin-left:auto;color:#64748b;font-weight:700">WhatsApp: +91-7986297302</div>
        </div>
      </div>
    </section>

    <!-- CONTACT -->
    <section id="contact">
      <h2 style="color:var(--brand-700)">Contact Us</h2>
      <div style="margin-top:14px" class="contact-grid">
        <div class="contact-card">
          <h4>Address</h4>
          <p>SCO 15, Sia Homes, Lalton Chowk, Pakhowal Road, Ludhiana - 142022, Punjab, India</p>
        </div>
        <div class="contact-card">
          <h4>Phone / WhatsApp</h4>
          <p><a href="tel:+917986297302">+91-7986297302</a></p>
        </div>
        <div class="contact-card">
          <h4>Email</h4>
          <p><a href="mailto:export@srineelkanth.com">export@srineelkanth.com</a></p>
        </div>
      </div>
    </section>

  </main>

  <!-- CART PANEL (slide-in) -->
  <aside id="cart-panel" class="cart-panel" aria-hidden="true">
    <div class="panel-head">
      <div style="display:flex;gap:12px;align-items:center">
        <i class="fa fa-shopping-cart" style="color:var(--brand-700)"></i>
        <div>
          <div style="font-weight:800">Your Cart</div>
          <div style="font-size:13px;color:#64748b" id="cart-items-count">0 items</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button onclick="downloadCartPDF()" title="Download PDF" style="background:transparent;border:none;cursor:pointer"><i class="fa fa-file-pdf" style="color:#e03b3b;font-size:18px"></i></button>
        <button onclick="closeCartPanel()" title="Close" style="background:transparent;border:none;font-size:18px;cursor:pointer"><i class="fa fa-times"></i></button>
      </div>
    </div>

    <div class="panel-body" id="cart-contents" tabindex="0">
      <!-- cart items inserted here -->
    </div>

    <div class="panel-foot">
      <div class="total">Get special quote for below products</div>
      <div style="display:flex;gap:8px">
        <button class="send-btn" onclick="openCartEnquiryModal()">Send as Enquiry (WhatsApp)</button>
        <button class="send-btn" style="background:#0b3b6e" onclick="clearCart()">Clear Cart</button>
      </div>
    </div>
  </aside>

  <!-- CART DETAILS MODAL (collect user info) -->
  <div id="cart-modal" style="display:none;position:fixed;inset:0;align-items:center;justify-content:center;background:rgba(0,0,0,0.4);z-index:1600">
    <div style="background:white;padding:18px;border-radius:10px;max-width:520px;margin:18px">
      <h3>Enter your details</h3>
      <div class="form-row" style="margin-top:8px">
        <input id="cart-cust-name" placeholder="Name (required)"/>
        <input id="cart-cust-email" placeholder="Email (optional)"/>
      </div>
      <div class="form-row" style="margin-top:8px">
        <input id="cart-cust-mobile" placeholder="Mobile (required)"/>
        <input id="cart-cust-city" placeholder="City"/>
      </div>
      <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
        <button class="send-btn" onclick="sendCartEnquiry()">Send</button>
        <button class="send-btn" style="background:#9aa9bd" onclick="closeCartModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer>
    <div class="footer-inner">
      <div>
        <div style="font-weight:800">GROTECH</div>
        <div style="font-size:13px;opacity:0.9">Sri Neelkanth Impex Pvt. Ltd.</div>
      </div>
      <div class="quick-links">
        <a href="#home">Home</a>
        <a href="#about">About</a>
        <a href="#products">Products</a>
        <a href="#enquiry">Enquiry</a>
        <a href="#contact">Contact</a>
      </div>
      <div style="opacity:0.9">© 2025 SRI NEELKANTH IMPEX PVT. LTD.</div>
    </div>
  </footer>

  <!-- ===========================
       Inline JavaScript (main)
       =========================== -->
  <script>
    /* ---------------- Configuration ---------------- */
    const DATA_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTp1LlW5tsWIyE7E5BGFiKHS2qBjzh8wGaZdR3EsQSzXVyxgq1hrh4y54KpkVHiL-4Moux0CA43c4nb/pub?gid=0&single=true&output=csv";
    const IMAGE_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTp1LlW5tsWIyE7E5BGFiKHS2qBjzh8wGaZdR3EsQSzXVyxgq1hrh4y54KpkVHiL-4Moux0CA43c4nb/pub?gid=676833393&single=true&output=csv";
    const CATEGORY_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTp1LlW5tsWIyE7E5BGFiKHS2qBjzh8wGaZdR3EsQSzXVyxgq1hrh4y54KpkVHiL-4Moux0CA43c4nb/pub?gid=2136776722&single=true&output=csv";
    const SHEET_WEBHOOK = ""; // optional webhook for saving enquiries
    const WHATSAPP_NUMBER = "917986297302"; // without +

    /* ---------------- State ---------------- */
    let allData = [];
    let imageMap = {};
    let categoryImageMap = {};
    let currentCategory = null;
    let currentItemCode = null;
    let currentSearchResults = null;

    /* ---------------- Helpers for UI ---------------- */
    const $ = id => document.getElementById(id);

    // open / close cart panel
    const cartPanel = $('cart-panel') || document.querySelector('#cart-panel');
    function openCartPanel(){ cartPanel.classList.add('open'); cartPanel.setAttribute('aria-hidden','false'); renderCart(); }
    function closeCartPanel(){ cartPanel.classList.remove('open'); cartPanel.setAttribute('aria-hidden','true'); }

    document.getElementById('open-cart-btn').addEventListener('click', ()=> openCartPanel() );

    // open/close cart modal
    function openCartEnquiryModal(){ $('cart-modal').style.display='flex'; }
    function closeCartModal(){ $('cart-modal').style.display='none'; }

    /* ---------------- Load CSVs ---------------- */
    Promise.all([
      fetch(DATA_URL).then(r=>r.text()),
      fetch(IMAGE_URL).then(r=>r.text()),
      fetch(CATEGORY_URL).then(r=>r.text())
    ]).then(([dataText,imageText,categoryText])=>{
      allData = Papa.parse(dataText,{header:true}).data.filter(r=>r["Item Code"] && r["Category"]);
      allData.forEach(r=>{ if(r["Category"]) r["Category"] = r["Category"].trim(); });

      Papa.parse(imageText,{header:true}).data.forEach(r=>{
        if (r["Item Code"] && r["Image URL"]) imageMap[r["Item Code"].trim()] = r["Image URL"];
      });

      Papa.parse(categoryText,{header:true}).data.forEach(r=>{
        if (r["Category"] && r["Image URL"]) categoryImageMap[r["Category"].trim()] = r["Image URL"];
      });

      // Populate category filter dropdown
      const categories = [...new Set(allData.map(i=>i['Category']))].filter(Boolean).sort();
      const catSelect = $('categoryFilter');
      categories.forEach(cat=>{
        const opt = document.createElement('option'); opt.value = cat; opt.textContent = cat;
        catSelect.appendChild(opt);
      });
      catSelect.addEventListener('change', ()=> {
        const v = catSelect.value;
        if(v) renderItems(v); else renderCategories();
      });

      renderCategories();
      updateCartCount();
    }).catch(e=>{
      const c = document.getElementById('catalogue');
      if(c) c.innerHTML = '<p>❌ Failed to load data.</p>';
      console.error(e);
    });

    /* ---------------- Breadcrumb ---------------- */
    function renderBreadcrumb(level){
      const breadcrumb = document.getElementById("breadcrumb");
      if(!breadcrumb) return;
      let html = '';
      if (level === "category") html = `<button class="back-btn" onclick="renderCategories()" style="padding:8px;border-radius:8px;border:none;background:#f1f6fb;cursor:pointer">⬅ Back to Categories</button>`;
      else if (level === "item") html = `<button class="back-btn" onclick="renderItems('${currentCategory.replace(/'/g,\"\\\\'\")}')" style="padding:8px;border-radius:8px;border:none;background:#f1f6fb;cursor:pointer">⬅ Back to ${currentCategory}</button>`;
      else if (level === "search") html = `<button class="back-btn" onclick="clearSearch()" style="padding:8px;border-radius:8px;border:none;background:#f1f6fb;cursor:pointer">⬅ Back to Home</button>`;
      breadcrumb.innerHTML = html;
    }

    /* ---------------- Categories (Home view) ---------------- */
    function renderCategories(){
      currentCategory = null; currentItemCode = null; currentSearchResults = null; renderBreadcrumb('');
      const container = document.getElementById('catalogue');
      container.innerHTML = '';
      const categories = [...new Set(allData.map(i=>i['Category']))].filter(Boolean).sort();
      categories.forEach(cat=>{
        const div = document.createElement('div'); div.className='card category-card';
        const catImg = categoryImageMap[cat] || ('https://via.placeholder.com/500x300?text='+encodeURIComponent(cat));
        div.innerHTML = `<img src="${catImg}" alt="${cat}" class="card-image"/><div class="card-title">${cat}</div>`;
        div.addEventListener('click', ()=> renderItems(cat));
        container.appendChild(div);
      });
    }

    /* ---------------- Items ---------------- */
    function renderItems(category){
      currentCategory = category;
      renderBreadcrumb('category');
      const container = document.getElementById('catalogue');
      container.innerHTML = '';
      // list unique item codes within category
      const items = [...new Set(allData.filter(r=>r['Category']===category).map(r=>r['Item Code']))];
      items.forEach(code=>{
        const item = allData.find(r=>r['Item Code']===code) || {};
        const img = imageMap[code] || ('https://via.placeholder.com/400x300?text='+encodeURIComponent(code));
        const div = document.createElement('div'); div.className='card';
        div.innerHTML = `
          <img src="${img}" alt="${item['Item Name']||code}" class="card-image"/>
          <div class="card-title">${item['Item Name']||code}</div>
          <div class="card-code">Code: ${code}</div>
          <div class="card-footer">
            <button class="small-btn add-btn" onclick="renderItemDetail('${code}')">View Details</button>
            <a class="chat-link" href="https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent('Hi, I\\'m interested in '+(item['Item Name']||code))}" target="_blank"><i class="fa fa-whatsapp"></i> Chat</a>
          </div>
        `;
        container.appendChild(div);
      });
    }

    /* ---------------- Item Detail (variants + Add to Cart) ---------------- */
    function renderItemDetail(itemCode){
      currentItemCode = itemCode; renderBreadcrumb('item');
      const entries = allData.filter(r=>r['Item Code']===itemCode && (!currentCategory || r['Category']===currentCategory));
      if(entries.length===0){ document.getElementById('catalogue').innerHTML='<p>No item found.</p>'; return; }
      const first = entries[0];
      const img = imageMap[itemCode] || ('https://via.placeholder.com/640x480?text='+encodeURIComponent(itemCode));
      const container = document.getElementById('catalogue');
      container.innerHTML = `
        <div style="display:flex;flex-direction:column;gap:12px">
          <div style="display:flex;gap:18px;flex-wrap:wrap">
            <img src="${img}" alt="${itemCode}" style="max-width:420px;border-radius:10px" />
            <div style="flex:1">
              <h3 style="margin:0 0 8px 0">${first['Item Name'] || ''}</h3>
              <p style="margin:0 0 10px 0;color:#64748b"><strong>Item Code:</strong> ${first['Item Code'] || ''} &nbsp; | &nbsp; <strong>HSN:</strong> ${first['HSN Code']||''}</p>
              <p style="margin:0 0 12px 0;color:#374151"><em>${first['Specs'] || ''}</em></p>
              <div style="margin-top:8px">
                <button class="small-btn add-btn" onclick="renderCategories()">Back to Categories</button>
              </div>
            </div>
          </div>

          <table style="width:100%;border-collapse:collapse">
            <thead>
              <tr style="background:#f3f7fb">
                <th style="padding:10px;border:1px solid #eef3fb">Variant Code</th>
                <th style="padding:10px;border:1px solid #eef3fb">Description</th>
                <th style="padding:10px;border:1px solid #eef3fb">Price/Unit</th>
                <th style="padding:10px;border:1px solid #eef3fb">Unit</th>
                <th style="padding:10px;border:1px solid #eef3fb">MOQ</th>
                <th style="padding:10px;border:1px solid #eef3fb">Actions</th>
              </tr>
            </thead>
            <tbody>
              ${entries.reduce((unique,entry)=>{ if(!unique.some(e=>e['Variant Code']===entry['Variant Code'])) unique.push(entry); return unique; },[]).map(entry=>{
                const price = entry['Price/Unit']||'';
                // encode values carefully
                const encItem = encodeURIComponent(itemCode);
                const encVariant = encodeURIComponent(entry['Variant Code']||'');
                const encDesc = encodeURIComponent(entry['Description']||'');
                const encPrice = encodeURIComponent(price);
                return `<tr>
                  <td style="padding:10px;border:1px solid #eef3fb">${entry['Variant Code']||''}</td>
                  <td style="padding:10px;border:1px solid #eef3fb">${entry['Description']||''}</td>
                  <td style="padding:10px;border:1px solid #eef3fb">${price}</td>
                  <td style="padding:10px;border:1px solid #eef3fb">${entry['Unit']||''}</td>
                  <td style="padding:10px;border:1px solid #eef3fb">${entry['MOQ']||''}</td>
                  <td style="padding:10px;border:1px solid #eef3fb">
                    <button class="small-btn add-btn" onclick="addToCartPrompt('${encItem}','${encVariant}','${encDesc}','${encPrice}')">Add to Cart</button>
                    <a class="chat-link" target="_blank" href="https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent('Hi, I\\'m interested in this tool:\\nItem: '+(first['Item Name']||'')+'\\nVariant Code: '+(entry['Variant Code']||'')+'\\nDescription: '+(entry['Description']||'')+'\\nPrice: '+price)}"><i class="fa fa-whatsapp"></i> Chat</a>
                  </td>
                </tr>`}).join('')}
            </tbody>
          </table>
        </div>
      `;
    }

    function addToCartPrompt(itemCodeEnc, variantEnc, descEnc, priceEnc){
      const itemCode = decodeURIComponent(itemCodeEnc);
      const variantCode = decodeURIComponent(variantEnc);
      const description = decodeURIComponent(descEnc);
      const price = decodeURIComponent(priceEnc);
      let qty = prompt('Enter required quantity for Variant '+variantCode+':','1');
      if(qty===null) return; qty = qty.trim(); if(qty===''||isNaN(qty)||Number(qty)<=0){ alert('Please enter a valid quantity'); return; }
      addToCart({ itemCode, variantCode, description, price, qty: Number(qty) });
    }

    /* ---------------- Cart Management ---------------- */
    function getCart(){ try{ return JSON.parse(localStorage.getItem('sni_cart')||'[]'); }catch(e){ return []; } }
    function saveCart(cart){ localStorage.setItem('sni_cart', JSON.stringify(cart)); updateCartCount(); renderCart(); }
    function addToCart(item){
      const cart = getCart();
      const existing = cart.find(c=>c.variantCode===item.variantCode);
      if(existing){ existing.qty = existing.qty + item.qty; }
      else{
        const first = allData.find(r=>r['Item Code']===item.itemCode) || {};
        const img = imageMap[item.itemCode] || '';
        cart.push({ itemCode: item.itemCode, itemName: first['Item Name']||'', variantCode: item.variantCode, description: item.description, price: item.price, unit: first['Unit']||'', qty: item.qty, img });
      }
      saveCart(cart);
      // open panel to show added
      openCartPanel();
    }

    function renderCart(){
      const container = document.getElementById('cart-contents');
      const cart = getCart();
      $('cart-items-count').textContent = `${cart.length} item${cart.length!==1?'s':''}`;
      if(cart.length===0){ container.innerHTML = '<p>Your cart is empty.</p>'; updateCartCount(); return; }
      let html = '';
      cart.forEach((c,idx)=>{
        const imgUrl = c.img || ('https://via.placeholder.com/120?text='+encodeURIComponent(c.itemCode));
        html += `<div class="cart-item">
          <img src="${imgUrl}" alt="${c.itemName||c.itemCode}"/>
          <div class="meta">
            <div class="name">${c.itemName||c.itemCode}</div>
            <div class="variant">${c.variantCode}</div>
            <div style="margin-top:6px;font-weight:700;color:#0b3b6e">${c.price||''}</div>
          </div>
          <div style="display:flex;flex-direction:column;align-items:flex-end;gap:8px">
            <input class="qty-input" type="number" min="1" value="${c.qty}" onchange="updateQty(${idx}, this.value)"/>
            <button style="background:transparent;border:none;color:#e03b3b;cursor:pointer" onclick="removeCartItem(${idx})">Remove</button>
          </div>
        </div>`;
      });
      container.innerHTML = html;
      updateCartCount();
    }

    function updateQty(index,val){ const cart = getCart(); val = Number(val); if(isNaN(val)||val<=0) return; cart[index].qty = val; saveCart(cart); renderCart(); }
    function removeCartItem(index){ const cart = getCart(); cart.splice(index,1); saveCart(cart); renderCart(); }
    function clearCart(){ if(!confirm('Clear cart?')) return; localStorage.removeItem('sni_cart'); renderCart(); updateCartCount(); closeCartPanel(); }

    function updateCartCount(){ const n = getCart().reduce((s,i)=>s+i.qty,0); const el = document.getElementById('cart-count'); if(el) el.innerText = n; }

    /* ---------------- PDF Export ---------------- */
    async function downloadCartPDF(){ const cart = getCart(); if(cart.length===0){ alert('Cart empty'); return; }
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({unit:'pt',format:'a4'});
      let y = 40; doc.setFontSize(16); doc.text('SRI NEELKANTH IMPEX PVT. LTD. - Cart Quote', 40, y); y+=20;
      doc.setFontSize(11);
      cart.forEach((c,idx)=>{
        const line = `${idx+1}. ${c.itemName||c.itemCode} | Variant: ${c.variantCode} | Qty: ${c.qty} | Price: ${c.price}`;
        if(y>760){ doc.addPage(); y=40; }
        doc.text(line, 40, y); y+=16;
      });
      doc.save('cart-quote.pdf');
    }

    /* ---------------- Cart Enquiry (WhatsApp) ---------------- */
    function sendCartEnquiry(){
      const name = document.getElementById('cart-cust-name').value.trim();
      const mobile = document.getElementById('cart-cust-mobile').value.trim();
      const email = document.getElementById('cart-cust-email').value.trim();
      const city = document.getElementById('cart-cust-city').value.trim();
      if(!name||!mobile){ alert('Please enter Name and Mobile'); return; }
      const cart = getCart(); if(cart.length===0){ alert('Cart is empty'); return; }
      let msg = `Enquiry from ${name} (City: ${city || 'N/A'})\nMobile: ${mobile}${email?('\\nEmail: '+email):''}\n\nItems:`;
      cart.forEach(c=>{ msg += `\n- ${c.itemName||c.itemCode} | Variant: ${c.variantCode} | Qty: ${c.qty} | Price: ${c.price}`; });
      const wa = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`;
      if(SHEET_WEBHOOK){
        try{ fetch(SHEET_WEBHOOK,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({type:'cart_enquiry',name,city,mobile,email,cart})}); }catch(e){ console.warn('sheet save failed',e); }
      }
      window.open(wa,'_blank'); closeCartModal(); closeCartPanel();
    }

    /* ---------------- Enquiry Form ---------------- */
    function sendEnquiry(){
      const name = document.getElementById('enq-name').value.trim();
      const email = document.getElementById('enq-email').value.trim();
      const mobile = document.getElementById('enq-mobile').value.trim();
      const city = document.getElementById('enq-city').value.trim();
      const req = document.getElementById('enq-requirements').value.trim();
      if(!name||!mobile||!req){ alert('Please enter Name, Mobile and Requirements'); return; }
      const msg = `Enquiry from ${name} (City: ${city||'N/A'})\nMobile: ${mobile}${email?('\\nEmail: '+email):''}\n\nRequirement:\n${req}`;
      if(SHEET_WEBHOOK){
        try{ fetch(SHEET_WEBHOOK,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({type:'enquiry',name,email,mobile,city,req})}); }catch(e){ console.warn('sheet save failed',e); }
      }
      const wa = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`;
      window.open(wa,'_blank');
      alert('Opening WhatsApp to send your enquiry');
    }
    function tryStoreEnquiry(){
      if(!SHEET_WEBHOOK){ alert('No SHEET_WEBHOOK configured. To enable, set SHEET_WEBHOOK variable in the script to your Google Apps Script Web App URL.'); return; }
      const name = document.getElementById('enq-name').value.trim(); const email = document.getElementById('enq-email').value.trim();
      const mobile = document.getElementById('enq-mobile').value.trim(); const city = document.getElementById('enq-city').value.trim();
      const req = document.getElementById('enq-requirements').value.trim();
      if(!name||!mobile){ alert('Name and Mobile required to save'); return; }
      fetch(SHEET_WEBHOOK,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({type:'enquiry',name,email,mobile,city,req})})
        .then(()=>alert('Saved to sheet (if webhook valid)')).catch(()=>alert('Failed to save to sheet'));
    }

    /* ---------------- Global Search ---------------- */
    function performSearch(){
      const query = (document.getElementById('searchInput')?.value || '').trim().toLowerCase();
      const cat = (document.getElementById('categoryFilter')?.value || '').trim();
      if(!query && !cat) { renderCategories(); return; }

      currentSearchResults = allData.filter(r=>(
        (r['Item Code']||'').toLowerCase().includes(query) ||
        (r['Item Name']||'').toLowerCase().includes(query) ||
        (r['Category']||'').toLowerCase().includes(query)
      ) && (cat? r['Category']===cat : true));

      renderBreadcrumb('search');
      const container = document.getElementById('catalogue');
      container.innerHTML = '';
      const uniqueItems = [...new Set(currentSearchResults.map(row => row["Item Code"]))];
      if (uniqueItems.length === 0) {
        container.innerHTML = '<p>No results found.</p>';
        return;
      }
      uniqueItems.forEach(code=>{
        const item = allData.find(r=>r['Item Code']===code) || {};
        const img = imageMap[code] || ('https://via.placeholder.com/400x300?text='+encodeURIComponent(code));
        const div = document.createElement('div'); div.className='card';
        div.innerHTML = `
          <img src="${img}" alt="${item['Item Name']||code}" class="card-image"/>
          <div class="card-title">${item['Item Name']||code}</div>
          <div class="card-code">Code: ${code}</div>
          <div class="card-footer">
            <button class="small-btn add-btn" onclick="renderItemDetail('${code}')">View Details</button>
            <a class="chat-link" href="https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent('Hi, I\\'m interested in '+(item['Item Name']||code))}" target="_blank"><i class="fa fa-whatsapp"></i> Chat</a>
          </div>
        `;
        container.appendChild(div);
      });
    }

    function clearSearch(){ document.getElementById('searchInput').value=''; document.getElementById('categoryFilter').value=''; renderCategories(); }

    // init cart count on load
    updateCartCount();

    // smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(a=>{
      a.addEventListener('click', function(e){
        const href = this.getAttribute('href');
        if(href.startsWith('#')){
          e.preventDefault();
          const target = document.querySelector(href);
          if(target) target.scrollIntoView({behavior:'smooth', block:'start'});
        }
      });
    });
  </script>
</body>
</html>
